---
import Container from '~/components/Container.astro'
import { Site } from '~/constants'
import BackToTop from '~/components/BackToTop.astro'
---

<style>
  @reference '../styles/global.css';

  footer {
    @apply py-6 text-sm;
  }
</style>

<script>
  import {
    resolveThemeValue,
    toggleTheme,
    getThemeValue
  } from './theme'

  const activeStyles = ['bg-black/5', 'dark:bg-white/5']
  let lightThemeButton: HTMLElement | null = null
  let darkThemeButton: HTMLElement | null = null
  let systemThemeButton: HTMLElement | null = null

  function setActiveButton(button: HTMLElement | null) {
    lightThemeButton?.classList.remove(...activeStyles)
    darkThemeButton?.classList.remove(...activeStyles)
    systemThemeButton?.classList.remove(...activeStyles)
    button?.classList.add(...activeStyles)
  }

  function applyTheme(
    themeValue: string,
    button?: HTMLElement | null
  ) {
    button ??= document.querySelector(`button[data-value='${themeValue}']`) as HTMLElement | null

    const theme = resolveThemeValue(themeValue)

    localStorage.setItem('theme', themeValue)
    toggleTheme(theme === 'dark')
    setActiveButton(button)
  }

  function onClick(event: MouseEvent) {
    const button = event.currentTarget as HTMLElement
    const themeValue = button.dataset.value!

    applyTheme(themeValue, button)
  }

  function onPageLoad() {
    lightThemeButton = document.getElementById('light-theme-button')!
    darkThemeButton = document.getElementById('dark-theme-button')!
    systemThemeButton = document.getElementById('system-theme-button')!

    lightThemeButton.addEventListener('click', onClick)
    darkThemeButton.addEventListener('click', onClick)
    systemThemeButton.addEventListener('click', onClick)

    applyTheme(getThemeValue())
  }

  onPageLoad()
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
    if (localStorage.theme === 'system') {
      toggleTheme(event.matches);
    }
  })
</script>

<footer>
  <Container>
    <div class='relative'>
      <div class='absolute -top-12 left-1/2 -translate-x-1/2 sm:left-auto sm:right-0 sm:translate-x-0'>
        <BackToTop/>
      </div>
    </div>
    <div class='flex flex-col gap-4 items-center sm:flex-row sm:items-center sm:justify-between'>
      <div>&copy; {new Date().getFullYear()} â€¢ {Site.Title}</div>
      <div class='flex flex-wrap items-center gap-1.5'>
        <button
          id='light-theme-button'
          aria-label='Light theme'
          class='group flex size-9 items-center justify-center rounded-sm border border-black/15 hover:bg-black/5 focus-visible:bg-black/5 dark:border-white/20 dark:hover:bg-white/5 dark:focus-visible:bg-white/5'
          data-value='light'
        >
          <svg
            xmlns='http://www.w3.org/2000/svg'
            width='18'
            height='18'
            viewBox='0 0 24 24'
            fill='none'
            stroke='currentColor'
            stroke-width='1.5'
            stroke-linecap='round'
            stroke-linejoin='round'
            class='transition-colors duration-300 ease-in-out group-hover:animate-pulse group-hover:stroke-black group-focus-visible:animate-pulse group-focus-visible:stroke-black dark:group-hover:stroke-white dark:group-focus-visible:stroke-white'
          >
            <circle
              cx='12'
              cy='12'
              r='5'
            />
            <line
              x1='12'
              y1='1'
              x2='12'
              y2='3'
            />
            <line
              x1='12'
              y1='21'
              x2='12'
              y2='23'
            />
            <line
              x1='4.22'
              y1='4.22'
              x2='5.64'
              y2='5.64'
            />
            <line
              x1='18.36'
              y1='18.36'
              x2='19.78'
              y2='19.78'
            />
            <line
              x1='1'
              y1='12'
              x2='3'
              y2='12'
            />
            <line
              x1='21'
              y1='12'
              x2='23'
              y2='12'
            />
            <line
              x1='4.22'
              y1='19.78'
              x2='5.64'
              y2='18.36'
            />
            <line
              x1='18.36'
              y1='5.64'
              x2='19.78'
              y2='4.22'
            />
          </svg>
        </button>
        <button
          id='dark-theme-button'
          aria-label='Dark theme'
          class='group flex size-9 items-center justify-center rounded-sm border border-black/15 hover:bg-black/5 focus-visible:bg-black/5 dark:border-white/20 dark:hover:bg-white/5 dark:focus-visible:bg-white/5'
          data-value='dark'
        >
          <svg
            xmlns='http://www.w3.org/2000/svg'
            width='18'
            height='18'
            viewBox='0 0 24 24'
            fill='none'
            stroke='currentColor'
            stroke-width='1.5'
            stroke-linecap='round'
            stroke-linejoin='round'
            class='transition-colors duration-300 ease-in-out group-hover:animate-pulse group-hover:stroke-black group-focus-visible:animate-pulse group-focus-visible:stroke-black dark:group-hover:stroke-white dark:group-focus-visible:stroke-white'
          >
            <path d='M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z'/>
          </svg>
        </button>
        <button
          id='system-theme-button'
          aria-label='System theme'
          class='group flex size-9 items-center justify-center rounded-sm border border-black/15 hover:bg-black/5 focus-visible:bg-black/5 dark:border-white/20 dark:hover:bg-white/5 dark:focus-visible:bg-white/5'
          data-value='system'
        >
          <svg
            xmlns='http://www.w3.org/2000/svg'
            width='18'
            height='18'
            viewBox='0 0 24 24'
            fill='none'
            stroke='currentColor'
            stroke-width='1.5'
            stroke-linecap='round'
            stroke-linejoin='round'
            class='transition-colors duration-300 ease-in-out group-hover:animate-pulse group-hover:stroke-black group-focus-visible:animate-pulse group-focus-visible:stroke-black dark:group-hover:stroke-white dark:group-focus-visible:stroke-white'
          >
            <rect
              x='2'
              y='3'
              width='20'
              height='14'
              rx='2'
              ry='2'
            />
            <line
              x1='8'
              y1='21'
              x2='16'
              y2='21'
            />
            <line
              x1='12'
              y1='17'
              x2='12'
              y2='21'
            />
          </svg>
        </button>
      </div>
    </div>
  </Container>
</footer>
